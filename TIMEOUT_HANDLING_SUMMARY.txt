================================================================================
TIMEOUT HANDLING AND RETRY LOGIC
================================================================================

PROBLEM:
  Playbook generation timed out after 10 minutes, causing complete failure.

SOLUTION:

  1. INCREASED TIMEOUT TO 30 MINUTES
     - Changed from: timeout=None (unclear)
     - Changed to: timeout=1800 (30 minutes explicit)
     - Also added: request_timeout=1800

  2. ADDED RETRY LOGIC FOR GENERATION
     - 3 automatic retry attempts on timeout
     - Total possible time: 90 minutes (3 √ó 30 min)
     - Non-timeout errors fail immediately
  
  3. ADDED RETRY LOGIC FOR ANALYSIS
     - 3 automatic retry attempts on timeout
     - Graceful fallback: proceeds if all attempts timeout
     - Analysis failure doesn't block execution

USER EXPERIENCE:

  Before:
    Generating Ansible playbook...
    [10 minutes]
    ‚ùå Error: Request timed out
  
  After:
    Generating Ansible playbook...
    Generation attempt 1/3...
    [timeout]
    ‚ö†Ô∏è  Generation timed out on attempt 1/3
    üîÑ Retrying playbook generation...
    Generation attempt 2/3...
    ‚úÖ Success!

TIMEOUT VALUES:

  Component              | Timeout  | Retries | Max Total
  -----------------------|----------|---------|----------
  Model Request          | 30 min   | N/A     | 30 min
  Playbook Generation    | 30 min   | 3       | 90 min
  Playbook Analysis      | 30 min   | 3       | 90 min*
  
  * Analysis proceeds anyway if all attempts timeout (graceful fallback)

WHY TIMEOUTS OCCUR:

  ‚úì Complex requirements (many checks)
  ‚úì Network issues (intermittent connectivity)
  ‚úì Server load (DeepSeek API busy)
  ‚úì Model selection (deepseek-reasoner slower)
  ‚úì Large context (long KCS articles)

MITIGATION:

  1. Use deepseek-chat (faster than deepseek-reasoner)
  2. Reduce requirements (interactive editing)
  3. Retry logic (now automatic!)
  4. Increase timeout if needed (configurable)

SPECIAL HANDLING FOR ANALYSIS:

  Why different?
    - Generation failure = no playbook (critical)
    - Analysis failure = unverified playbook (acceptable)
  
  Graceful degradation:
    If all analysis attempts timeout:
      ‚Üí Proceed anyway with warning
      ‚Üí User can manually review playbook
      ‚Üí Better unverified playbook than no playbook

ERROR MESSAGES:

  Generation timeout:
    ‚ùå Error: Playbook generation timed out after 3 attempts
  
  Analysis timeout (graceful):
    ‚ö†Ô∏è  Analysis timed out, proceeding anyway...
    ‚úÖ Execution proceeding (analysis could not complete)

CONFIGURATION:

  Adjust timeout (if needed):
    model = ChatDeepSeek(
        timeout=3600,  # 60 minutes
        request_timeout=3600
    )
  
  Adjust retry attempts:
    max_generation_attempts = 5  # More retries
    max_analysis_attempts = 5

BEST PRACTICES:

  1. Start with deepseek-chat (faster)
  2. Monitor progress (watch attempt numbers)
  3. Simplify requirements first
  4. Ensure stable network connection
  5. Be patient (30 min timeout is generous)

BENEFITS:

  ‚úÖ Automatic retry on transient issues
  ‚úÖ Clear progress feedback
  ‚úÖ Graceful degradation (analysis)
  ‚úÖ More robust generation
  ‚úÖ Better user experience

FILES CHANGED:
  - deepseek_generate_playbook.py
    * Increased timeout to 30 minutes
    * Added retry logic for generation (3 attempts)
    * Added retry logic for analysis (3 attempts + fallback)
    * Added progress messages

STATUS: ‚úÖ IMPLEMENTED
DATE: January 11, 2026
IMPACT: Improved reliability, automatic timeout recovery
================================================================================
